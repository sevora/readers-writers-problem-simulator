var ae=Object.defineProperty;var le=(e,t,n)=>t in e?ae(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var d=(e,t,n)=>le(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const u of s.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&o(u)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();var c=(e=>(e[e.READY=0]="READY",e[e.RUNNING=1]="RUNNING",e[e.WAITING=2]="WAITING",e[e.EXIT=3]="EXIT",e))(c||{});class F{constructor(t,n){d(this,"context");d(this,"initialize");d(this,"step");d(this,"file");d(this,"state");d(this,"priority");this.initialize=t,this.step=n;const o=t();this.context=o[0],this.state=o[1],this.priority=0}connect(t){this.file=t}disconnect(){this.file=void 0}update(){if(this.file){const t=this.step(this,this.context,this.file);t&&(this.state=t)}}reset(){const t=this.initialize();this.context={...this.context,...t[0]},this.state=t[1]}}class de{constructor(){d(this,"processes");d(this,"afterProcessUpdate");d(this,"afterAllProcessExit");d(this,"now");d(this,"then");d(this,"fps");d(this,"running");this.processes=[],this.now=Date.now(),this.then=this.now,this.fps=12,this.running=!1}addProcess(t){this.processes.push(t)}removeProcess(t){for(let n=this.processes.length-1;n>=0;--n)if(t===this.processes[n]){this.processes.splice(n,1);break}}setPriority(t,n){for(let o=0;o<this.processes.length;++o)if(t===this.processes[o]){this.processes[o].priority=n,this.processes.sort((r,s)=>s.priority-r.priority);break}}start(){this.running=!0,this.loop()}loop(){if(!this.running)return;window.requestAnimationFrame(this.loop.bind(this)),this.now=Date.now();const t=this.now-this.then,n=1e3/this.fps;t>n&&(this.then=this.now-t%n,this.step())}step(){const t=[];for(let n of this.processes){if(n.state===c.EXIT||!n.file){t.push(!0);continue}n.state=c.RUNNING;const o=1+Math.floor(Math.random()*3);for(let r=0;r<o;++r)n.update(),this.afterProcessUpdate&&this.afterProcessUpdate(n)}t.length===this.processes.length&&this.afterAllProcessExit&&this.afterAllProcessExit()}stop(){this.running=!1}reset(){this.running=!1;for(let t of this.processes)t.reset()}}var M=(e=>(e[e.LOCKED=0]="LOCKED",e[e.OUT_OF_BOUNDS=1]="OUT_OF_BOUNDS",e))(M||{}),W=(e=>(e[e.READ=0]="READ",e[e.WRITE=1]="WRITE",e))(W||{});class P{constructor(t,n){d(this,"filename");d(this,"content");d(this,"backupContent");d(this,"locker");d(this,"lockMode");d(this,"disabledLock");d(this,"statechange");this.filename=t,this.content=n,this.backupContent=n,this.locker=void 0,this.lockMode=void 0,this.disabledLock=!0}readAt(t,n){return this.locker&&this.locker!==t&&this.lockMode===1?0:n>this.content.length-1?1:this.content[n]}writeAt(t,n,o){if(this.locker&&this.locker!==t)return 0;if(n>this.content.length-1)return 1;const r=this.content[n];this.content=this.content.substring(0,n)+o(r)+this.content.substring(n+1),this.statechange&&this.statechange(this)}lock(t,n){!this.disabledLock&&!this.locker&&!this.lockMode&&(this.locker=t,this.lockMode=n)}unlock(){this.locker=void 0,this.lockMode=void 0}disableLock(){this.disabledLock=!0,this.locker=void 0,this.lockMode=void 0}enableLock(){this.disabledLock=!1}reset(){this.content=this.backupContent,this.locker=void 0,this.lockMode=void 0}}var b=(e=>(e[e.READER=0]="READER",e[e.WRITER=1]="WRITER",e))(b||{});function ue(){return new F(()=>[{index:0,output:"",type:0},c.READY],(e,t,n)=>{n.lock(e,W.READ);const o=n.readAt(e,t.index);if(o===M.LOCKED)return c.WAITING;if(o===M.OUT_OF_BOUNDS)return n.unlock(),c.EXIT;t.output+=o,t.index++})}function pe(){return new F(()=>[{index:0,output:"",type:1},c.READY],(e,t,n)=>{n.lock(e,W.WRITE);const o=n.writeAt(e,t.index,r=>r.toUpperCase());if(o===M.LOCKED)return c.WAITING;if(o===M.OUT_OF_BOUNDS)return n.unlock(),c.EXIT;t.index++})}function he(){return new F(()=>[{index:0,output:"",type:1},c.READY],(e,t,n)=>{n.lock(e,W.WRITE);const o=n.writeAt(e,t.index,r=>["$","%","^","=","+","!"][Math.floor(Math.random()*6)]);if(o===M.LOCKED)return c.WAITING;if(o===M.OUT_OF_BOUNDS)return n.unlock(),c.EXIT;t.index++})}function fe(){return new F(()=>[{index:0,output:"",type:1},c.READY],(e,t,n)=>{n.lock(e,W.WRITE);const o=n.writeAt(e,t.index,r=>r.toLowerCase());if(o===M.LOCKED)return c.WAITING;if(o===M.OUT_OF_BOUNDS)return n.unlock(),c.EXIT;t.index++})}function me(){return new P("roosevelt.txt","Great minds discuss ideas; average minds discuss events; small minds discuss people.")}function ge(){return new P("einstein.txt","I have no special talent. I am only passionately curious.")}function be(){return new P("nietzsche.txt","That which does not kill us makes us stronger.")}function ve(){return new P("aristotle.txt","We are what we repeatedly do; excellence, then, is not an act but a habit.")}function we(){return new P("shakespeare.txt","It is not in the stars to hold our destiny but in ourselves.")}function xe(e,t){const n=document.createElement("button");n.className="flex items-center gap-2 px-2 py-1 text-left cursor-pointer hover:bg-neutral-700 ";const o=document.createElement("div");o.className="text-sm px-2 py-1 rounded-xl "+(e===b.READER?"bg-green-500":"bg-blue-500"),o.innerHTML=e===b.READER?"Reader":"Writer";const r=document.createElement("div");return r.innerHTML=t,n.append(o),n.append(r),n}function G(e){const t=document.createElement("button");return t.innerHTML=e,t}function ye(e,t,n,o,r){const s=document.createElement("div");s.className="absolute select-none cursor-grab border w-[300px] bg-neutral-800 text-white flex flex-wrap group "+(e===b.READER?"border-gradient-green":"border-gradient-blue");const u=document.createElement("div");u.className="py-4 px-2 flex gap-2 grow";const h=document.createElement("div");h.className="px-2 py-1 rounded-full "+(e===b.READER?"bg-green-500":"bg-blue-500"),h.innerHTML=e===b.READER?"Reader":"Writer";const g=document.createElement("div");g.className="name flex items-center",g.innerHTML=t;const k=document.createElement("div");if(k.className="rank flex px-2 ml-auto justify-center items-center rounded-xl bg-neutral-900",k.innerHTML="#0",u.append(h,g,k),s.append(u),e===b.READER){const y=document.createElement("div");y.className="w-full p-3 bg-neutral-900 rounded-b-md",y.innerHTML="Output: ";const I=document.createElement("span");I.className="output break-words",y.append(I),s.append(y)}const m=document.createElement("div");m.className="absolute -right-6 top-1 invisible group-hover:visible z-10 flex flex-col gap-1 *:cursor-pointer";const i=document.createElement("button");i.className="bg-neutral-800 w-12 h-12 rounded-md flex items-center justify-center border border-neutral-600 hover:bg-neutral-900";const f=document.createElement("span");f.className="material-icons",f.innerHTML="link",i.append(f);const l=document.createElement("button");l.className="bg-neutral-800 w-12 h-12 rounded-md flex items-center justify-center border border-neutral-600 hover:bg-neutral-900";const a=document.createElement("span");a.className="material-icons",a.innerHTML="delete",l.append(a),m.append(i,l),i.addEventListener("mousedown",n),l.addEventListener("mousedown",o),s.append(m);let w=!1,x,O;const T=document.createElement("div");return T.className="w-screen h-screen z-50 fixed top-0 left-0 cursor-grabbing",s.addEventListener("mousedown",y=>{w=!0,x=y.clientX-s.offsetLeft,O=y.clientY-s.offsetTop,s.style.zIndex="100",T.style.zIndex="200",document.body.appendChild(T)}),T.addEventListener("mousemove",y=>{if(!w)return;let I=y.clientX-x,B=y.clientY-O;I=Math.max(0,Math.min(I,window.innerWidth-300)),B=Math.max(0,Math.min(B,window.innerHeight-50)),s.style.left=`${I}px`,s.style.top=`${B}px`,r(y,I,B)}),T.addEventListener("mouseup",y=>{w=!1,s.style.removeProperty("z-index"),document.body.removeChild(T)}),s}function Ee(e,t){const n=document.createElement("div");n.className="none cursor-grab border text-left cursor-pointer hover:bg-neutral-700  !w-54 text-sm border-neutral-900 bg-neutral-800/80 text-white flex flex-col items-start group";const o=document.createElement("div");o.className="p-2 grow-0";const r=document.createElement("div");r.className="bg-neutral-900 px-2 grow-0 rounded-full",r.innerHTML=e,o.append(r);const s=document.createElement("div");return s.className="bg-neutral-900 w-full p-2 group-hover:bg-neutral-900/60",s.innerHTML=t,n.append(o,s),n}function ke(e,t,n){const o=document.createElement("div");o.className="absolute select-none cursor-grab border w-[300px] border-neutral-900 bg-neutral-800 text-white flex flex-col items-start group";const r=document.createElement("div");r.className="p-2 grow-0";const s=document.createElement("div");s.className="bg-neutral-900 px-2 grow-0 rounded-full",s.innerHTML=e,r.append(s);const u=document.createElement("div");u.className="content break-words bg-neutral-900 w-full p-2",u.innerHTML=t;const h=document.createElement("div");h.className="absolute -right-6 top-1 invisible group-hover:visible z-10 flex flex-col gap-1 *:cursor-pointer";const g=document.createElement("button");g.className="bg-neutral-800 w-12 h-12 rounded-md flex items-center justify-center border border-neutral-600 hover:bg-neutral-900";const k=document.createElement("span");k.className="material-icons",k.innerHTML="delete",g.append(k),g.addEventListener("mousedown",n),h.append(g),o.append(r,u,h);let m=!1,i,f;const l=document.createElement("div");return l.className="w-screen h-screen z-50 fixed top-0 left-0 cursor-grabbing",o.addEventListener("mousedown",a=>{m=!0,i=a.clientX-o.offsetLeft,f=a.clientY-o.offsetTop,o.style.zIndex="100",l.style.zIndex="200",document.body.appendChild(l)}),l.addEventListener("mousemove",a=>{if(!m)return;let w=a.clientX-i,x=a.clientY-f;w=Math.max(0,Math.min(w,window.innerWidth-300)),x=Math.max(0,Math.min(x,window.innerHeight-50)),o.style.left=`${w}px`,o.style.top=`${x}px`}),l.addEventListener("mouseup",a=>{m=!1,o.style.removeProperty("z-index"),document.body.removeChild(l)}),o}const ne=document.querySelector("#management-panel-header"),N=document.querySelector("#management-panel-content"),oe=Ce(),A=document.querySelector("#control-play-stop"),$=document.querySelector("#control-reset"),j=document.querySelector("#control-clear-all"),C=document.querySelector("#control-solution-toggle"),Le=document.querySelector("#counter-process"),Me=document.querySelector("#counter-file"),Q=document.querySelector("#solution"),K=document.querySelector("#sandbox"),re=document.querySelector("#prevent-interactions-cover"),D=document.querySelector("#connection-canvas"),Ne=D.getContext("2d"),V=5,De=5;let H=!1,L,v=[],E=[],U=Date.now(),Z=U,Ie=60,ee=1e3/Ie,q=window.innerWidth*2,S=window.innerHeight*2,R;const p=new de;p.afterProcessUpdate=e=>{e.context.statechange&&e.context.statechange(e)};p.afterAllProcessExit=()=>{setTimeout(()=>{ie()},1)};function Re(){D.width=q,D.height=S,se()}function se(){window.requestAnimationFrame(se),U=Date.now();let e=U-Z;e>ee&&(Z=U-e%ee,Te())}function Te(){const e=Ne;if(e.clearRect(0,0,q,S),L&&R){const[t,n]=L,o=n.getBoundingClientRect();e.strokeStyle=t.context.type===b.READER?"#00e24b":"#4f9fdb",e.lineWidth=5,e.globalAlpha=.5,e.beginPath(),e.moveTo((parseInt(n.style.left)+o.width*.5)*2,(parseInt(n.style.top)+o.height*.5)*2),e.lineTo(R[0],R[1]),e.stroke()}for(const[t,n]of v)if(t.file){for(const[o,r]of E)if(t.file===o){const s=n.getBoundingClientRect(),u=r.getBoundingClientRect(),h=[(parseInt(n.style.left)+s.width*.5)*2,(parseInt(n.style.top)+s.height*.5)*2],g=[(parseInt(r.style.left)+u.width*.5)*2,(parseInt(r.style.top)+u.height*.5)*2];e.strokeStyle=t.context.type===b.READER?"#00e24b":"#4f9fdb",e.lineWidth=5,e.globalAlpha=1,(t.state===c.WAITING||t.state===c.EXIT)&&p.running&&(e.globalAlpha=.25),e.beginPath(),e.moveTo(h[0],h[1]),e.lineTo(g[0],g[1]),e.stroke();break}}}function Ae(){for(const e of ne.children)e.className=""}function Ce(){const e=[G("Processes"),G("Files"),G("Overview")];for(let t=0;t<e.length;++t)e[t].addEventListener("click",o=>{switch(Ae(),o.currentTarget.classList.add("bg-neutral-900","hover:!bg-neutral-900"),t){case 0:He();break;case 1:We();break;case 2:J();break}});return ne.append(...e),e}function He(){N.replaceChildren();const e=[["Read by letter",b.READER,ue],["Write to uppercase",b.WRITER,pe],["Write to lowercase",b.WRITER,fe],["Distort content",b.WRITER,he]];for(let t=0;t<e.length;++t){const[n,o,r]=e[t],s=xe(o,n);s.addEventListener("click",function(u){if(v.length+1>V)return;const h=w=>{if(f.file||L){L=void 0,R=void 0,f.disconnect();return}L=[f,i]},g=w=>{for(let x=v.length-1;x>=0;--x)if(v[x][0]===f){v.splice(x,1);break}L=void 0,R=void 0,p.removeProcess(f),i.remove(),X(),A.disabled=z()===0},k=(w,x,O)=>{p.setPriority(f,-O),te(),Y()},m=`${n} (${ce(3)})`,i=ye(o,m,h,g,k),f=r();f.context.statechange=w=>{switch(w.context.type===b.READER&&(i.querySelector(".output").innerHTML=w.context.output),w.state){case c.READY:i.classList.add("ready-process"),i.classList.remove("running-process","waiting-process","exit-process");break;case c.RUNNING:i.classList.add("running-process"),i.classList.remove("ready-process","waiting-process","exit-process");break;case c.WAITING:i.classList.add("waiting-process"),i.classList.remove("ready-process","running-process","exit-process");break;case c.EXIT:i.classList.add("exit-process"),i.classList.remove("ready-process","running-process","waiting-process");break}J()},p.addProcess(f),K.appendChild(i),v.push([f,i]);const l=i.getBoundingClientRect(),a=window.innerHeight*.5-l.height*.5;i.style.left=window.innerWidth*.5-l.width*.5+"px",i.style.top=a+"px",p.setPriority(f,-a),X(),te(),Y()}),N.appendChild(s)}}function We(){N.replaceChildren();const e=[me,ge,be,ve,we];for(let t=0;t<e.length;++t){const n=e[t],{filename:o,content:r}=n(),s=Ee(o,r);s.addEventListener("click",function(u){if(E.length+1>V)return;const h=n(),g=l=>{for(const[a]of v)a.file===h&&a.disconnect();for(let a=E.length-1;a>=0;--a)if(E[a][0]===h){E.splice(a,1);break}m.remove(),A.disabled=z()===0},k=o.split(".").map((l,a)=>a===0?l+"_"+ce(3):l).join("."),m=ke(k,r,g);m.addEventListener("mousedown",l=>{if(!L)return;L[0].connect(h),L=void 0,R=void 0,A.disabled=z()===0}),h.statechange=l=>{m.querySelector(".content").innerHTML=l.content},K.appendChild(m),E.push([h,m]);const i=m.getBoundingClientRect(),f=window.innerHeight*.5-i.height*.5;m.style.left=window.innerWidth*.5-i.width*.5+"px",m.style.top=f+"px",H||h.disableLock(),X()}),N.appendChild(s)}}function J(){if(N.replaceChildren(),p.running){const e=document.createElement("table");e.className="max-w-[200px] table-auto";const t=[["Process","State"],...v.map(([o,r])=>{let s;switch(o.state){case c.READY:s="Ready";break;case c.RUNNING:s="Running";break;case c.WAITING:s="Waiting";break;case c.EXIT:s="Exit";break}return[r.querySelector(".name").innerHTML,s]})];for(const o of t){const r=document.createElement("tr");for(const s of o){const u=document.createElement("td");u.className="px-3 border break-words",u.innerHTML=s,r.appendChild(u)}e.appendChild(r)}N.appendChild(e);const n=document.createElement("div");n.className="max-w-[200px] text-left px-3 select-none",n.innerHTML="Moving out of this panel will clear the values and overview.",N.appendChild(n)}else{const e=document.createElement("div");e.className="max-w-[200px] text-left px-3 select-none",e.innerHTML="Run simulation to see values in real-time.",N.appendChild(e)}}function te(){for(const[e,t]of v)t.querySelector(".rank").innerHTML="#"+(p.processes.indexOf(e)+1)}function Y(){if(H){if(p.processes.length>0){const e=p.processes[0];Q.innerHTML=e.context.type===b.READER?"Reader's Preference Solution":"Writer's Preference Solution"}}else Q.innerHTML="Readers-Writers Problem"}function ie(){p.stop(),A.querySelector("span").innerHTML="play_arrow",j.disabled=!1,$.disabled=!1,C.disabled=!1;for(const[e,t]of v)t.classList.remove("ready-process","running-process","waiting-process","exit-process");re.classList.replace("block","hidden")}function _(){ie(),p.reset();for(const[e,t]of v){const n=t.querySelector(".output");n&&(n.innerHTML="")}for(const[e,t]of E)e.reset(),t.querySelector(".content").innerHTML=e.content}function z(){return v.filter(([e])=>e.file).length}function ce(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=new Uint32Array(e);return window.crypto.getRandomValues(n),Array.from(n,o=>t[o%t.length]).join("")}$.addEventListener("click",e=>{p.running||_()});j.addEventListener("click",e=>{p.running||(p.processes.splice(0,p.processes.length),v.splice(0,v.length),E.splice(0,E.length),K.replaceChildren(),X())});A.addEventListener("click",e=>{if(p.running){_(),J();return}_(),p.start(),A.querySelector("span").innerHTML="stop",j.disabled=!0,$.disabled=!0,C.disabled=!0,re.classList.replace("hidden","block"),oe[2].click()});function X(){Le.innerHTML=`${v.length}/${V}`,Me.innerHTML=`${E.length}/${De}`}C.addEventListener("click",e=>{if(!p.running){if(H){for(const[t]of E)t.disableLock();C.innerHTML="OS Read-Write Lock Disabled"}else{for(const[t]of E)t.enableLock();C.innerHTML="OS Read-Write Lock Enabled"}H=!H,Y()}});document.body.addEventListener("mousemove",e=>{if(!L)return;const t=D.getBoundingClientRect();let n=D.width/t.width,o=D.height/t.height;R=[(e.clientX-t.left)*n,(e.clientY-t.top)*o]});window.addEventListener("resize",e=>{q=window.innerWidth*2,S=window.innerHeight*2,D.width=q,D.height=S});Re();oe[0].click();
